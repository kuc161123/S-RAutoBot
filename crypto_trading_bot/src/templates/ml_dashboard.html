<!DOCTYPE html>
<html>
<head>
    <title>Ultra Intelligent Trading Bot - ML Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
        }
        
        h1 { 
            text-align: center; 
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(90deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .card:hover { 
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .ml-card {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1));
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        .trading-card {
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.1), rgba(0, 119, 190, 0.1));
            border: 1px solid rgba(0, 191, 255, 0.3);
        }
        
        .performance-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .risk-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(185, 28, 28, 0.1));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .card h2 { 
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
        }
        
        .card h3 {
            margin: 15px 0 10px 0;
            font-size: 1.1em;
            color: #a78bfa;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .metric:last-child { border-bottom: none; }
        
        .metric-label { 
            opacity: 0.7; 
            font-size: 0.95em;
        }
        
        .metric-value { 
            font-weight: 600;
            font-size: 1.05em;
        }
        
        .ml-confidence {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .confidence-very-high { 
            background: rgba(16, 185, 129, 0.2); 
            color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        
        .confidence-high { 
            background: rgba(59, 130, 246, 0.2); 
            color: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        
        .confidence-medium { 
            background: rgba(251, 191, 36, 0.2); 
            color: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }
        
        .confidence-low { 
            background: rgba(239, 68, 68, 0.2); 
            color: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }
        
        .portfolio-heat-gauge {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }
        
        .heat-fill {
            height: 100%;
            transition: width 0.5s ease, background 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .heat-low { 
            background: linear-gradient(90deg, #10b981, #34d399); 
        }
        
        .heat-medium { 
            background: linear-gradient(90deg, #fbbf24, #f59e0b); 
        }
        
        .heat-high { 
            background: linear-gradient(90deg, #ef4444, #dc2626);
            animation: heat-pulse 1s infinite;
        }
        
        @keyframes heat-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .feature-importance {
            margin: 10px 0;
        }
        
        .feature-name {
            font-size: 0.9em;
            margin-bottom: 3px;
            opacity: 0.8;
        }
        
        .importance-bar-container {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .importance-bar {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #3b82f6);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-right: 8px;
            justify-content: flex-end;
            color: #fff;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .positions-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        
        .positions-table th {
            background: rgba(139, 92, 246, 0.2);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(139, 92, 246, 0.3);
        }
        
        .positions-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .positions-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .btn {
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }
        
        .status-healthy { 
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        .status-degraded { 
            background: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }
        
        .status-unhealthy { 
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid #10b981;
        }
        
        .notification.error {
            border-left: 4px solid #ef4444;
        }
        
        .notification.info {
            border-left: 4px solid #3b82f6;
        }
        
        #lastUpdate {
            text-align: center;
            opacity: 0.7;
            margin-top: 20px;
            font-size: 0.9em;
        }
        
        .large-metric {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(90deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .zone-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }
        
        .zone-supply {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .zone-demand {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Ultra Intelligent Trading Bot - ML Dashboard</h1>
        
        <div class="control-panel">
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="enableTrading()">‚ñ∂Ô∏è Enable Trading</button>
                <button class="btn" onclick="disableTrading()">‚è∏Ô∏è Disable Trading</button>
                <button class="btn" onclick="fetchPositions()">üìä View Positions</button>
                <button class="btn" onclick="fetchMLStats()">üß† ML Stats</button>
                <button class="btn btn-danger" onclick="emergencyStop()">üõë Emergency Stop</button>
            </div>
        </div>
        
        <div class="dashboard-grid" id="dashboard">
            <!-- Dashboard content will be dynamically loaded here -->
            <div class="card">Loading...</div>
        </div>
        
        <div id="lastUpdate"></div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script>
        let charts = {};
        
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type} show`;
            notification.innerHTML = message;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        async function fetchHealth() {
            try {
                const response = await fetch('/health/detailed');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Failed to fetch health data:', error);
                showNotification('Failed to fetch health data', 'error');
            }
        }
        
        async function fetchMLStats() {
            try {
                const response = await fetch('/api/ml/stats');
                const data = await response.json();
                
                if (data.error) {
                    showNotification(`ML Stats Error: ${data.error}`, 'error');
                    return;
                }
                
                let message = '<h3>üß† ML Model Statistics</h3>';
                message += `<p><strong>Model Trained:</strong> ${data.model_trained ? '‚úÖ Yes' : '‚ùå No'}</p>`;
                message += `<p><strong>Training Samples:</strong> ${data.training_samples}/${data.min_samples_required}</p>`;
                message += `<p><strong>Test Accuracy:</strong> ${(data.test_accuracy * 100).toFixed(1)}%</p>`;
                
                if (data.feature_importance && Object.keys(data.feature_importance).length > 0) {
                    message += '<p><strong>Top Features:</strong></p><ul>';
                    const sorted = Object.entries(data.feature_importance)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 3);
                    for (const [feature, importance] of sorted) {
                        message += `<li>${feature}: ${(importance * 100).toFixed(1)}%</li>`;
                    }
                    message += '</ul>';
                }
                
                showNotification(message, 'info', 10000);
            } catch (error) {
                showNotification('Failed to fetch ML stats', 'error');
            }
        }
        
        async function fetchPositions() {
            try {
                const response = await fetch('/api/performance/detailed');
                const data = await response.json();
                
                if (data.error) {
                    showNotification(`Error: ${data.error}`, 'error');
                    return;
                }
                
                if (data.active_positions && data.active_positions.length > 0) {
                    let html = '<h3>üìà Active Positions</h3><table class="positions-table">';
                    html += '<tr><th>Symbol</th><th>Side</th><th>Entry</th><th>Current</th><th>P&L</th><th>ML Conf</th><th>Duration</th></tr>';
                    
                    data.active_positions.forEach(pos => {
                        const pnlColor = pos.unrealized_pnl >= 0 ? '#10b981' : '#ef4444';
                        const confClass = pos.ml_confidence >= 0.85 ? 'confidence-very-high' : 
                                        pos.ml_confidence >= 0.75 ? 'confidence-high' :
                                        pos.ml_confidence >= 0.65 ? 'confidence-medium' : 'confidence-low';
                        
                        html += `<tr>
                            <td>${pos.symbol}</td>
                            <td>${pos.side}</td>
                            <td>$${pos.entry_price.toFixed(4)}</td>
                            <td>$${pos.current_price.toFixed(4)}</td>
                            <td style="color: ${pnlColor}">$${pos.unrealized_pnl.toFixed(2)}</td>
                            <td><span class="ml-confidence ${confClass}">${(pos.ml_confidence * 100).toFixed(0)}%</span></td>
                            <td>${Math.round(pos.duration_minutes)}m</td>
                        </tr>`;
                    });
                    html += '</table>';
                    showNotification(html, 'info', 15000);
                } else {
                    showNotification('No active positions', 'info');
                }
            } catch (error) {
                showNotification('Failed to fetch positions', 'error');
            }
        }
        
        async function enableTrading() {
            try {
                const response = await fetch('/api/enable', { method: 'POST' });
                const data = await response.json();
                showNotification(data.message || 'Trading enabled', 'success');
                fetchHealth();
            } catch (error) {
                showNotification('Failed to enable trading', 'error');
            }
        }
        
        async function disableTrading() {
            try {
                const response = await fetch('/api/disable', { method: 'POST' });
                const data = await response.json();
                showNotification(data.message || 'Trading disabled', 'info');
                fetchHealth();
            } catch (error) {
                showNotification('Failed to disable trading', 'error');
            }
        }
        
        async function emergencyStop() {
            if (!confirm('‚ö†Ô∏è This will close all positions immediately. Are you sure?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/emergency_stop', { method: 'POST' });
                const data = await response.json();
                showNotification(data.message || 'Emergency stop executed', 'error');
                fetchHealth();
            } catch (error) {
                showNotification('Failed to execute emergency stop', 'error');
            }
        }
        
        async function updateDashboard(healthData) {
            const dashboard = document.getElementById('dashboard');
            const lastUpdate = document.getElementById('lastUpdate');
            
            // Fetch additional data
            const [mlStats, tradingMetrics, performance, zones] = await Promise.all([
                fetch('/api/ml/stats').then(r => r.json()).catch(() => ({})),
                fetch('/api/trading/metrics').then(r => r.json()).catch(() => ({})),
                fetch('/api/performance/detailed').then(r => r.json()).catch(() => ({})),
                fetch('/api/zones/summary').then(r => r.json()).catch(() => ({}))
            ]);
            
            let html = '';
            
            // Trading Status Card
            const tradingEnabled = tradingMetrics.trading_enabled !== undefined ? tradingMetrics.trading_enabled : false;
            const emergencyStop = tradingMetrics.emergency_stop || false;
            
            html += `
                <div class="card trading-card">
                    <h2>
                        <span class="status-indicator status-${tradingEnabled && !emergencyStop ? 'healthy' : 'unhealthy'}"></span>
                        Trading Status
                    </h2>
                    <div class="metric">
                        <span class="metric-label">Trading Enabled</span>
                        <span class="metric-value">${tradingEnabled ? '‚úÖ Yes' : '‚ùå No'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Emergency Stop</span>
                        <span class="metric-value">${emergencyStop ? 'üõë ACTIVE' : '‚úÖ Clear'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Active Positions</span>
                        <span class="metric-value">${tradingMetrics.active_positions || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Monitored Symbols</span>
                        <span class="metric-value">${tradingMetrics.monitored_symbols || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Portfolio Heat</span>
                        <div class="portfolio-heat-gauge">
                            <div class="heat-fill ${tradingMetrics.portfolio_heat < 0.5 ? 'heat-low' : tradingMetrics.portfolio_heat < 0.8 ? 'heat-medium' : 'heat-high'}" 
                                 style="width: ${(tradingMetrics.portfolio_heat * 100) || 0}%">
                                ${((tradingMetrics.portfolio_heat * 100) || 0).toFixed(1)}%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ML Model Status Card
            html += `
                <div class="card ml-card">
                    <h2>üß† ML Model Status</h2>
                    <div class="metric">
                        <span class="metric-label">Model Status</span>
                        <span class="metric-value">${mlStats.model_trained ? '‚úÖ Trained' : '‚è≥ Learning'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Training Samples</span>
                        <span class="metric-value">${mlStats.training_samples || 0} / ${mlStats.min_samples_required || 100}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Test Accuracy</span>
                        <span class="metric-value">${((mlStats.test_accuracy || 0) * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Prediction Success</span>
                        <span class="metric-value">${((mlStats.prediction_success_rate || 0) * 100).toFixed(1)}%</span>
                    </div>
                    ${mlStats.feature_importance && Object.keys(mlStats.feature_importance).length > 0 ? `
                        <h3>Feature Importance</h3>
                        ${Object.entries(mlStats.feature_importance)
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, 4)
                            .map(([feature, importance]) => `
                                <div class="feature-importance">
                                    <div class="feature-name">${feature.replace(/_/g, ' ')}</div>
                                    <div class="importance-bar-container">
                                        <div class="importance-bar" style="width: ${importance * 100}%">
                                            ${(importance * 100).toFixed(0)}%
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                    ` : ''}
                </div>
            `;
            
            // Performance Metrics Card
            const winRate = performance.overall ? performance.overall.win_rate : 0;
            const dailyPnL = tradingMetrics.daily_pnl || 0;
            
            html += `
                <div class="card performance-card">
                    <h2>üìä Performance Metrics</h2>
                    <div class="large-metric">
                        ${dailyPnL >= 0 ? '+' : ''}$${dailyPnL.toFixed(2)}
                    </div>
                    <div class="metric">
                        <span class="metric-label">Win Rate</span>
                        <span class="metric-value">${winRate.toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Trades</span>
                        <span class="metric-value">${performance.overall?.total_trades || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Winning Trades</span>
                        <span class="metric-value">${performance.overall?.total_wins || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total P&L</span>
                        <span class="metric-value" style="color: ${(performance.overall?.total_pnl || 0) >= 0 ? '#10b981' : '#ef4444'}">
                            $${(performance.overall?.total_pnl || 0).toFixed(2)}
                        </span>
                    </div>
                </div>
            `;
            
            // Trading Signals Card
            html += `
                <div class="card trading-card">
                    <h2>üì° Trading Signals</h2>
                    <div class="metric">
                        <span class="metric-label">Signals Generated</span>
                        <span class="metric-value">${tradingMetrics.signals_generated || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Signals Executed</span>
                        <span class="metric-value">${tradingMetrics.signals_executed || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Execution Rate</span>
                        <span class="metric-value">${((tradingMetrics.execution_rate || 0) * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Pending Signals</span>
                        <span class="metric-value">${tradingMetrics.pending_signals || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Orders Fill Rate</span>
                        <span class="metric-value">${((tradingMetrics.fill_rate || 0) * 100).toFixed(1)}%</span>
                    </div>
                </div>
            `;
            
            // Supply & Demand Zones Card
            html += `
                <div class="card ml-card">
                    <h2>üìç Supply & Demand Zones</h2>
                    <div class="metric">
                        <span class="metric-label">Total Active Zones</span>
                        <span class="metric-value">${zones.total_zones || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Supply Zones</span>
                        <span class="metric-value">
                            <span class="zone-badge zone-supply">${zones.zones_by_type?.SUPPLY || 0}</span>
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Demand Zones</span>
                        <span class="metric-value">
                            <span class="zone-badge zone-demand">${zones.zones_by_type?.DEMAND || 0}</span>
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Zone Score</span>
                        <span class="metric-value">${(zones.avg_zone_score || 0).toFixed(1)}</span>
                    </div>
                    ${zones.best_zones && zones.best_zones.length > 0 ? `
                        <h3>Top Zones</h3>
                        ${zones.best_zones.slice(0, 3).map(zone => `
                            <div class="metric">
                                <span class="metric-label">${zone.symbol}</span>
                                <span class="metric-value">
                                    <span class="zone-badge zone-${zone.type.toLowerCase()}">${zone.score.toFixed(0)}</span>
                                </span>
                            </div>
                        `).join('')}
                    ` : ''}
                </div>
            `;
            
            // Risk Management Card
            html += `
                <div class="card risk-card">
                    <h2>‚ö†Ô∏è Risk Management</h2>
                    <div class="metric">
                        <span class="metric-label">Stop Loss Hits</span>
                        <span class="metric-value">${tradingMetrics.sl_hits || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Take Profit Hits</span>
                        <span class="metric-value">${tradingMetrics.tp_hits || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Partial Closes</span>
                        <span class="metric-value">${tradingMetrics.partial_closes || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Trailing Stops</span>
                        <span class="metric-value">${tradingMetrics.trailing_stops || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">System Errors</span>
                        <span class="metric-value" style="color: ${(tradingMetrics.errors || 0) > 10 ? '#ef4444' : '#10b981'}">
                            ${tradingMetrics.errors || 0}
                        </span>
                    </div>
                </div>
            `;
            
            // Top Performing Symbols
            if (performance.by_symbol && performance.by_symbol.length > 0) {
                html += `
                    <div class="card performance-card">
                        <h2>üèÜ Top Performing Symbols</h2>
                        <table class="positions-table">
                            <tr><th>Symbol</th><th>Trades</th><th>Win Rate</th><th>P&L</th></tr>
                            ${performance.by_symbol.slice(0, 5).map(sym => `
                                <tr>
                                    <td>${sym.symbol}</td>
                                    <td>${sym.trades}</td>
                                    <td>${sym.win_rate.toFixed(1)}%</td>
                                    <td style="color: ${sym.total_pnl >= 0 ? '#10b981' : '#ef4444'}">
                                        $${sym.total_pnl.toFixed(2)}
                                    </td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                `;
            }
            
            // System Health (from original health data)
            if (healthData.status) {
                html += `
                    <div class="card">
                        <h2>
                            <span class="status-indicator status-${healthData.status}"></span>
                            System Health
                        </h2>
                        <div class="metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value">${healthData.status.toUpperCase()}</span>
                        </div>
                        ${healthData.components ? Object.entries(healthData.components).map(([name, comp]) => `
                            <div class="metric">
                                <span class="metric-label">${name.replace(/_/g, ' ').toUpperCase()}</span>
                                <span class="metric-value">
                                    <span class="status-indicator status-${comp.status}"></span>
                                    ${comp.status.toUpperCase()}
                                </span>
                            </div>
                        `).join('') : ''}
                    </div>
                `;
            }
            
            dashboard.innerHTML = html;
            lastUpdate.innerHTML = `Last updated: ${new Date().toLocaleString()}`;
        }
        
        // Initial load
        fetchHealth();
        
        // Auto-refresh every 10 seconds
        setInterval(fetchHealth, 10000);
    </script>
</body>
</html>